# Matrix Authentication Service (MAS) Configuration
# Replace all {{PLACEHOLDER}} values with your actual configuration

# HTTP listener configuration
http:
  public_base: https://chat-auth.anewsunrises.com
  listeners:
    - name: web
      binds:
        - address: "0.0.0.0:8080"
      proxy_protocol: false
      resources:
        - name: discovery
        - name: human
        - name: oauth
        - name: compat
        - name: graphql
          playground: false
        - name: assets
    - name: internal
      resources:
        - name: health
      binds:
        - address: "0.0.0.0:8081"
      proxy_protocol: false

# Database configuration
database:
  # PostgreSQL connection string
  # Format: postgresql://user:password@host:port/database
  uri: "postgresql://matrix:{{POSTGRES_PASSWORD}}@postgres:5432/mas"
  # Connection pool settings
  min_connections: 5
  max_connections: 10

# Secrets configuration
secrets:
  # Encryption secret - MUST be exactly 32 bytes (64 hex characters)
  # Generate with: openssl rand -hex 32
  encryption: "{{MAS_SECRETS_ENCRYPTION}}"

  # Keys secret - MUST be exactly 32 bytes (64 hex characters)
  # Generate with: openssl rand -hex 32
  keys:
    - kid: "primary"
      key: "{{MAS_SECRETS_KEYS}}"

# Matrix homeserver configuration
matrix:
  homeserver: "chat.anewsunrises.com"
  # Secret token for MAS to call Synapse admin APIs
  # MUST match admin_token in homeserver.yaml
  secret: "ThisTokenIsStaticallyConfiguredAndShouldNotBeUsedInProduction"
  # Endpoint for Synapse admin API
  endpoint: "http://synapse:8008"

# OIDC clients configuration
clients:
  # Synapse client - used by Synapse to authenticate with MAS
  - client_id: "0000000000000000000SYNAPSE"
    client_auth_method: "client_secret_basic"
    client_secret: "SynapseSecret"

# Branding configuration
branding:
  service_name: "A New Sun Rises"

# Passwords configuration (for native MAS users)
passwords:
  enabled: true
  schemes:
    - version: 1
      algorithm: argon2id
  minimum_complexity: 3

# Registration settings
# matrix.registration controls who can create new accounts
# If you want open registration, set enabled: true
# For invite-only or admin-created users, set enabled: false
# registration_requires_approval: true means admin must approve new accounts
registration:
  enabled: false
  require_email: false

# Account management features
account:
  email_change_allowed: true
  display_name_change_allowed: true
# Policy URLs (optional)
# policy:
#   terms_of_service:
#     url: "https://{{MATRIX_DOMAIN}}/terms"
#   privacy_policy:
#     url: "https://{{MATRIX_DOMAIN}}/privacy"

# Email configuration (optional)
# Required if you want email verification, password resets, etc.
# email:
#   from: "noreply@{{MATRIX_DOMAIN}}"
#   reply_to: "support@{{MATRIX_DOMAIN}}"
#   transport: smtp
#   smtp:
#     mode: plain
#     hostname: "smtp.example.com"
#     port: 587
#     username: "noreply@{{MATRIX_DOMAIN}}"
#     password: "smtp_password"

# ============================================
# Important Notes:
# ============================================
#
# 1. Secrets must be EXACTLY 64 hex characters (32 bytes)
#    Generate with: openssl rand -hex 32
#
# 2. Database password MUST match POSTGRES_PASSWORD in .env
#    and the password in homeserver.yaml
#
# 3. Matrix secret and Synapse client credentials MUST match
#    the values in homeserver.yaml (msc3861 section)
#
# 4. If using upstream OAuth (Authelia):
#    - Uncomment the entire upstream_oauth2 section
#    - Replace all {{AUTHELIA_*}} placeholders
#    - Ensure redirect URI in Authelia is: https://{{MATRIX_DOMAIN}}/oauth2/callback
#    - Client secret in Authelia must be hashed with pbkdf2
#
# 5. The provider ID in upstream_oauth2 can be any unique string
#    We use a ULID format for uniqueness, but any string works
#
# 6. Discovery is automatic for OIDC providers
#    You usually don't need to specify endpoints manually
#
# 7. Registration settings:
#    - enabled: false = only admins can create users
#    - enabled: true = users can self-register
#    - require_email: true = email verification required
#
# ============================================
